<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Pet adoption classification. (week 4)</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="Pet adoption classification. (week 4)">
  <meta name="generator" content="bookdown 0.0.72 and GitBook 2.6.7">

  <meta property="og:title" content="Pet adoption classification. (week 4)" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Pet adoption classification. (week 4)" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="traning-and-evaluating-a-model.html">


<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="project-descriptin.html"><a href="project-descriptin.html"><i class="fa fa-check"></i><b>1</b> Project descriptin</a><ul>
<li class="chapter" data-level="1.1" data-path="project-descriptin.html"><a href="project-descriptin.html#goal-and-motivations"><i class="fa fa-check"></i><b>1.1</b> Goal and motivations</a></li>
<li class="chapter" data-level="1.2" data-path="project-descriptin.html"><a href="project-descriptin.html#getting-data"><i class="fa fa-check"></i><b>1.2</b> Getting Data</a></li>
<li class="chapter" data-level="1.3" data-path="project-descriptin.html"><a href="project-descriptin.html#load-data"><i class="fa fa-check"></i><b>1.3</b> Load data</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="clean-data-and-do-feature-engineering.html"><a href="clean-data-and-do-feature-engineering.html"><i class="fa fa-check"></i><b>2</b> Clean data and do feature engineering</a><ul>
<li class="chapter" data-level="2.1" data-path="clean-data-and-do-feature-engineering.html"><a href="clean-data-and-do-feature-engineering.html#feature-engineering"><i class="fa fa-check"></i><b>2.1</b> Feature Engineering</a><ul>
<li class="chapter" data-level="2.1.1" data-path="clean-data-and-do-feature-engineering.html"><a href="clean-data-and-do-feature-engineering.html#names"><i class="fa fa-check"></i><b>2.1.1</b> Names</a></li>
<li class="chapter" data-level="2.1.2" data-path="clean-data-and-do-feature-engineering.html"><a href="clean-data-and-do-feature-engineering.html#breed"><i class="fa fa-check"></i><b>2.1.2</b> Breed</a></li>
<li class="chapter" data-level="2.1.3" data-path="clean-data-and-do-feature-engineering.html"><a href="clean-data-and-do-feature-engineering.html#color"><i class="fa fa-check"></i><b>2.1.3</b> Color</a></li>
<li class="chapter" data-level="2.1.4" data-path="clean-data-and-do-feature-engineering.html"><a href="clean-data-and-do-feature-engineering.html#ageuponoutcome"><i class="fa fa-check"></i><b>2.1.4</b> AgeuponOutcome</a></li>
<li class="chapter" data-level="2.1.5" data-path="clean-data-and-do-feature-engineering.html"><a href="clean-data-and-do-feature-engineering.html#non-linear-features"><i class="fa fa-check"></i><b>2.1.5</b> non-linear features</a></li>
<li class="chapter" data-level="2.1.6" data-path="clean-data-and-do-feature-engineering.html"><a href="clean-data-and-do-feature-engineering.html#other-predictors"><i class="fa fa-check"></i><b>2.1.6</b> Other predictors</a></li>
<li class="chapter" data-level="2.1.7" data-path="clean-data-and-do-feature-engineering.html"><a href="clean-data-and-do-feature-engineering.html#convert-factors-to-factors"><i class="fa fa-check"></i><b>2.1.7</b> Convert factors to factors</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="clean-data-and-do-feature-engineering.html"><a href="clean-data-and-do-feature-engineering.html#dimension"><i class="fa fa-check"></i><b>2.2</b> Dimension</a></li>
<li class="chapter" data-level="2.3" data-path="clean-data-and-do-feature-engineering.html"><a href="clean-data-and-do-feature-engineering.html#create-binary-outcome"><i class="fa fa-check"></i><b>2.3</b> Create Binary outcome</a></li>
<li class="chapter" data-level="2.4" data-path="clean-data-and-do-feature-engineering.html"><a href="clean-data-and-do-feature-engineering.html#try-later"><i class="fa fa-check"></i><b>2.4</b> Try later</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="traning-and-evaluating-a-model.html"><a href="traning-and-evaluating-a-model.html"><i class="fa fa-check"></i><b>3</b> Traning and evaluating a model</a><ul>
<li class="chapter" data-level="3.1" data-path="traning-and-evaluating-a-model.html"><a href="traning-and-evaluating-a-model.html#pre-process-the-data"><i class="fa fa-check"></i><b>3.1</b> pre-process the data</a><ul>
<li class="chapter" data-level="3.1.1" data-path="traning-and-evaluating-a-model.html"><a href="traning-and-evaluating-a-model.html#creating-dummy-variables"><i class="fa fa-check"></i><b>3.1.1</b> Creating dummy variables</a></li>
<li class="chapter" data-level="3.1.2" data-path="traning-and-evaluating-a-model.html"><a href="traning-and-evaluating-a-model.html#deal-with-na"><i class="fa fa-check"></i><b>3.1.2</b> Deal with NA</a></li>
<li class="chapter" data-level="3.1.3" data-path="traning-and-evaluating-a-model.html"><a href="traning-and-evaluating-a-model.html#split-data-to-x-and-y"><i class="fa fa-check"></i><b>3.1.3</b> Split data to x and y</a></li>
<li class="chapter" data-level="3.1.4" data-path="traning-and-evaluating-a-model.html"><a href="traning-and-evaluating-a-model.html#create-dummmy-variables"><i class="fa fa-check"></i><b>3.1.4</b> Create dummmy variables</a></li>
<li class="chapter" data-level="3.1.5" data-path="traning-and-evaluating-a-model.html"><a href="traning-and-evaluating-a-model.html#check-for-correlated-predictors"><i class="fa fa-check"></i><b>3.1.5</b> Check for correlated predictors</a></li>
<li class="chapter" data-level="3.1.6" data-path="traning-and-evaluating-a-model.html"><a href="traning-and-evaluating-a-model.html#check-for-linear-dependencies"><i class="fa fa-check"></i><b>3.1.6</b> Check for linear dependencies</a></li>
<li class="chapter" data-level="3.1.7" data-path="traning-and-evaluating-a-model.html"><a href="traning-and-evaluating-a-model.html#split-data-to-train-and-test-set"><i class="fa fa-check"></i><b>3.1.7</b> Split data to train and test set</a></li>
<li class="chapter" data-level="3.1.8" data-path="traning-and-evaluating-a-model.html"><a href="traning-and-evaluating-a-model.html#if-needed-center-and-scale-or-range-0-to-1"><i class="fa fa-check"></i><b>3.1.8</b> If needed Center and scale, or range (0 to 1)</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="traning-and-evaluating-a-model.html"><a href="traning-and-evaluating-a-model.html#training-a-linear-model-glm---logisting-regression"><i class="fa fa-check"></i><b>3.2</b> Training a Linear model (glm - logisting regression)</a><ul>
<li class="chapter" data-level="3.2.1" data-path="traning-and-evaluating-a-model.html"><a href="traning-and-evaluating-a-model.html#script-for-linear-model-training"><i class="fa fa-check"></i><b>3.2.1</b> Script for linear model training</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="traning-and-evaluating-a-model.html"><a href="traning-and-evaluating-a-model.html#evaluating-linear-model"><i class="fa fa-check"></i><b>3.3</b> Evaluating Linear Model</a><ul>
<li class="chapter" data-level="3.3.1" data-path="traning-and-evaluating-a-model.html"><a href="traning-and-evaluating-a-model.html#predict-for-one-observation-of-training-data"><i class="fa fa-check"></i><b>3.3.1</b> Predict for one observation of training data</a></li>
<li class="chapter" data-level="3.3.2" data-path="traning-and-evaluating-a-model.html"><a href="traning-and-evaluating-a-model.html#predict-for-all-the-train-observations"><i class="fa fa-check"></i><b>3.3.2</b> Predict for all the train observations</a></li>
<li class="chapter" data-level="3.3.3" data-path="traning-and-evaluating-a-model.html"><a href="traning-and-evaluating-a-model.html#roc-curve"><i class="fa fa-check"></i><b>3.3.3</b> ROC Curve</a></li>
<li class="chapter" data-level="3.3.4" data-path="traning-and-evaluating-a-model.html"><a href="traning-and-evaluating-a-model.html#plot-get-probabilities"><i class="fa fa-check"></i><b>3.3.4</b> plot, get probabilities</a></li>
<li class="chapter" data-level="3.3.5" data-path="traning-and-evaluating-a-model.html"><a href="traning-and-evaluating-a-model.html#script-for-making-roc-curve"><i class="fa fa-check"></i><b>3.3.5</b> Script for making ROC curve</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="traning-and-evaluating-a-model.html"><a href="traning-and-evaluating-a-model.html#how-to-train-model-with-different-parameters---how-to-compare"><i class="fa fa-check"></i><b>3.4</b> How to train model with different parameters - how to compare</a></li>
<li class="chapter" data-level="3.5" data-path="traning-and-evaluating-a-model.html"><a href="traning-and-evaluating-a-model.html#rpart"><i class="fa fa-check"></i><b>3.5</b> Rpart</a><ul>
<li class="chapter" data-level="3.5.1" data-path="traning-and-evaluating-a-model.html"><a href="traning-and-evaluating-a-model.html#script-for-trees-model-training"><i class="fa fa-check"></i><b>3.5.1</b> Script for trees model training</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="traning-and-evaluating-a-model.html"><a href="traning-and-evaluating-a-model.html#rf"><i class="fa fa-check"></i><b>3.6</b> RF</a><ul>
<li class="chapter" data-level="3.6.1" data-path="traning-and-evaluating-a-model.html"><a href="traning-and-evaluating-a-model.html#script-for-trees-model-training-1"><i class="fa fa-check"></i><b>3.6.1</b> Script for trees model training</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="traning-and-evaluating-a-model.html"><a href="traning-and-evaluating-a-model.html#other-models-to-consider"><i class="fa fa-check"></i><b>3.7</b> Other models to consider</a><ul>
<li class="chapter" data-level="3.7.1" data-path="traning-and-evaluating-a-model.html"><a href="traning-and-evaluating-a-model.html#boosted-tree"><i class="fa fa-check"></i><b>3.7.1</b> boosted tree</a></li>
<li class="chapter" data-level="3.7.2" data-path="traning-and-evaluating-a-model.html"><a href="traning-and-evaluating-a-model.html#ada-boost"><i class="fa fa-check"></i><b>3.7.2</b> ADA boost</a></li>
<li class="chapter" data-level="3.7.3" data-path="traning-and-evaluating-a-model.html"><a href="traning-and-evaluating-a-model.html#svm"><i class="fa fa-check"></i><b>3.7.3</b> SVM</a></li>
<li class="chapter" data-level="3.7.4" data-path="traning-and-evaluating-a-model.html"><a href="traning-and-evaluating-a-model.html#combining-different-models."><i class="fa fa-check"></i><b>3.7.4</b> Combining different models.</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="training-a-model-for-all-classes.html"><a href="training-a-model-for-all-classes.html"><i class="fa fa-check"></i><b>4</b> Training a model for all classes</a><ul>
<li class="chapter" data-level="4.0.1" data-path="training-a-model-for-all-classes.html"><a href="training-a-model-for-all-classes.html#rpart-1"><i class="fa fa-check"></i><b>4.0.1</b> rpart</a></li>
<li class="chapter" data-level="4.0.2" data-path="training-a-model-for-all-classes.html"><a href="training-a-model-for-all-classes.html#creating-dummy-variables-1"><i class="fa fa-check"></i><b>4.0.2</b> Creating dummy variables</a></li>
<li class="chapter" data-level="4.0.3" data-path="training-a-model-for-all-classes.html"><a href="training-a-model-for-all-classes.html#deal-with-na-1"><i class="fa fa-check"></i><b>4.0.3</b> Deal with NA</a></li>
<li class="chapter" data-level="4.0.4" data-path="training-a-model-for-all-classes.html"><a href="training-a-model-for-all-classes.html#split-data-to-x-and-y-1"><i class="fa fa-check"></i><b>4.0.4</b> Split data to x and y</a></li>
<li class="chapter" data-level="4.0.5" data-path="training-a-model-for-all-classes.html"><a href="training-a-model-for-all-classes.html#create-dummmy-variables-1"><i class="fa fa-check"></i><b>4.0.5</b> Create dummmy variables</a></li>
<li class="chapter" data-level="4.0.6" data-path="training-a-model-for-all-classes.html"><a href="training-a-model-for-all-classes.html#check-for-correlated-predictors-1"><i class="fa fa-check"></i><b>4.0.6</b> Check for correlated predictors</a></li>
<li class="chapter" data-level="4.0.7" data-path="training-a-model-for-all-classes.html"><a href="training-a-model-for-all-classes.html#check-for-linear-dependencies-1"><i class="fa fa-check"></i><b>4.0.7</b> Check for linear dependencies</a></li>
<li class="chapter" data-level="4.0.8" data-path="training-a-model-for-all-classes.html"><a href="training-a-model-for-all-classes.html#split-data-to-train-and-test-set-1"><i class="fa fa-check"></i><b>4.0.8</b> Split data to train and test set</a></li>
<li class="chapter" data-level="4.0.9" data-path="training-a-model-for-all-classes.html"><a href="training-a-model-for-all-classes.html#if-needed-center-and-scale-or-range-0-to-1-1"><i class="fa fa-check"></i><b>4.0.9</b> If needed Center and scale, or range (0 to 1)</a></li>
<li class="chapter" data-level="4.0.10" data-path="training-a-model-for-all-classes.html"><a href="training-a-model-for-all-classes.html#rf-1"><i class="fa fa-check"></i><b>4.0.10</b> rf</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Pet adoption classification. (week 4)</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="training-a-model-for-all-classes" class="section level1">
<h1><span class="header-section-number">4</span> Training a model for all classes</h1>
<div id="rpart-1" class="section level3">
<h3><span class="header-section-number">4.0.1</span> rpart</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">use_formula =<span class="st"> </span><span class="ot">TRUE</span>
DF_for_prep &lt;-<span class="st"> </span>DF <span class="co"># use all outcomes</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">knitr::<span class="kw">spin_child</span>(<span class="st">&quot;scripts/Pre_process_data.R&quot;</span>)  </code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#knitr::opts_chunk$set(echo = TRUE, eval = FALSE)</span></code></pre></div>
<ul>
<li>to run use rmarkdown::render(“scripts/Pre_process_data.R”)</li>
<li>Or just press “compile notebook” button in Rstudio</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(caret)
y_ind =<span class="st"> </span><span class="dv">1</span>
x_ind =<span class="st"> </span><span class="dv">2</span>:<span class="kw">ncol</span>(DF_for_prep)</code></pre></div>
<ul>
<li>Read this <a href="http://topepo.github.io/caret/preprocess.html" class="uri">http://topepo.github.io/caret/preprocess.html</a>.</li>
<li>Only some of these methods were used here</li>
</ul>
</div>
<div id="creating-dummy-variables-1" class="section level3">
<h3><span class="header-section-number">4.0.2</span> Creating dummy variables</h3>
<p>Prepare a formula for interaction terms if needed</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">incl_var &lt;-<span class="st"> &quot;(AnimalType + PopName + BreedSH + BreedL + BreedD + BreedMix + Breed2)&quot;</span>
<span class="kw">library</span>(stringr)
form &lt;-<span class="st"> </span><span class="kw">str_c</span>(<span class="st">&quot;~ &quot;</span> ,  <span class="kw">str_c</span>(<span class="kw">names</span>(DF_for_prep)[-<span class="dv">1</span>], <span class="dt">collapse =</span> <span class="st">&quot; + &quot;</span>), 
              <span class="st">&quot;+ AgeOnOutcome:&quot;</span>, incl_var,
              <span class="st">&quot;+ AgeOnOutcome2:&quot;</span>, incl_var,
              <span class="st">&quot;+ AgeOnOutcome3:&quot;</span>, incl_var,
              <span class="st">&quot;+ AgeOnOutcome12:&quot;</span>, incl_var,
              <span class="st">&quot;+ AgeOnOutcome13:&quot;</span>, incl_var) 
form.f &lt;-<span class="st"> </span><span class="kw">as.formula</span>(form)</code></pre></div>
</div>
<div id="deal-with-na-1" class="section level3">
<h3><span class="header-section-number">4.0.3</span> Deal with NA</h3>
<p>we can do knn imputing, but in this case just remove NAs</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">DF_for_prep &lt;-<span class="st"> </span><span class="kw">na.omit</span>(DF_for_prep)</code></pre></div>
</div>
<div id="split-data-to-x-and-y-1" class="section level3">
<h3><span class="header-section-number">4.0.4</span> Split data to x and y</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(DF_for_prep)[y_ind] &lt;-<span class="st"> &quot;outcome&quot;</span>
y_data &lt;-<span class="st"> </span>DF_for_prep[, y_ind]
x_data &lt;-<span class="st"> </span>DF_for_prep[, x_ind]</code></pre></div>
</div>
<div id="create-dummmy-variables-1" class="section level3">
<h3><span class="header-section-number">4.0.5</span> Create dummmy variables</h3>
<p>before splitting the data. Otherwise train function will create dummies on the fly. But, in this case, training set will not have the same number of levels for each factor. This will create different number of predictros. The same is true for cross-validation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">if(use_formula ==<span class="st"> </span><span class="ot">TRUE</span>){
  dv &lt;-<span class="st"> </span><span class="kw">dummyVars</span>( form.f , <span class="dt">data =</span> x_data, <span class="dt">fullRank =</span> T) 
  <span class="co"># without fullRank we will have linearly dependent colomns: color will have TRUE and FALSE</span>
}else{
  dv &lt;-<span class="st"> </span><span class="kw">dummyVars</span>( ~<span class="st"> </span>. , <span class="dt">data =</span> x_data, <span class="dt">fullRank =</span> T)  
}

x_data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">predict</span>(dv, x_data))</code></pre></div>
</div>
<div id="check-for-correlated-predictors-1" class="section level3">
<h3><span class="header-section-number">4.0.6</span> Check for correlated predictors</h3>
<p>if correlated or linear dependent will remain glm will give error liek “glm.fit: fitted probabilities numerically 0 or 1 occurred”</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">descrCor &lt;-<span class="st"> </span><span class="kw">cor</span>(x_data)
highlyCorDescr &lt;-<span class="st"> </span><span class="kw">findCorrelation</span>(descrCor, <span class="dt">cutoff =</span> .<span class="dv">75</span>)
x_data &lt;-<span class="st"> </span>x_data[,-highlyCorDescr]</code></pre></div>
</div>
<div id="check-for-linear-dependencies-1" class="section level3">
<h3><span class="header-section-number">4.0.7</span> Check for linear dependencies</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">comboInfo &lt;-<span class="st"> </span><span class="kw">findLinearCombos</span>(x_data)

if(<span class="kw">length</span>(comboInfo$remove) &gt;<span class="st"> </span><span class="dv">0</span>) 
  x_data &lt;-<span class="st"> </span>x_data[, -comboInfo$remove]</code></pre></div>
</div>
<div id="split-data-to-train-and-test-set-1" class="section level3">
<h3><span class="header-section-number">4.0.8</span> Split data to train and test set</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">trainIndex &lt;-<span class="st"> </span><span class="kw">createDataPartition</span>(y_data$outcome, <span class="dt">p =</span> .<span class="dv">8</span>, <span class="dt">list =</span> F)
x_data_train &lt;-<span class="st"> </span>x_data[ trainIndex,]
x_data_test  &lt;-<span class="st"> </span>x_data[-trainIndex,]

y_data_train &lt;-<span class="st"> </span>y_data[ trainIndex,]
y_data_test &lt;-<span class="st"> </span>y_data[ -trainIndex,]</code></pre></div>
</div>
<div id="if-needed-center-and-scale-or-range-0-to-1-1" class="section level3">
<h3><span class="header-section-number">4.0.9</span> If needed Center and scale, or range (0 to 1)</h3>
<p>dummyVars comand created dummies as num. If we want to scale data, we either should recode them as factors or use range comand instead (will map data to interval (0, 1))</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#preProcValues &lt;- preProcess(x_data_train, method = c(&quot;range&quot;))</span>
<span class="co">#x_data_test &lt;- predict(preProcValues, x_data_test)</span>
<span class="co">#x_data_train &lt;- predict(preProcValues, x_data_train)</span></code></pre></div>
<p>How large is the df now</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cat</span>(<span class="st">&quot;New DF dimensions </span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="kw">dim</span>(x_data_train), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</code></pre></div>
<pre><code>## New DF dimensions 
##  21369 42</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cat</span>(<span class="st">&quot;n/p ratio is </span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="kw">dim</span>(x_data_train)[<span class="dv">1</span>]/<span class="kw">dim</span>(x_data_train)[<span class="dv">2</span>], <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</code></pre></div>
<pre><code>## n/p ratio is 
##  508.7857</code></pre>
<p>Data are ready</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df_train &lt;-<span class="st"> </span><span class="kw">data.frame</span>(x_data_train, y_data_train)
df_test &lt;-<span class="st"> </span><span class="kw">data.frame</span>(x_data_test, y_data_test)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">res_rp_all &lt;-<span class="st"> </span><span class="kw">train_Kappa</span>(df_train, <span class="dt">error_est =</span> <span class="st">&quot;cv&quot;</span>, <span class="dt">model =</span> <span class="st">&quot;rpart&quot;</span>, <span class="dt">par =</span> T)
res_rp_all$model
<span class="kw">confusionMatrix</span>(res_rp_all$model)</code></pre></div>
</div>
<div id="rf-1" class="section level3">
<h3><span class="header-section-number">4.0.10</span> rf</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">res_rf_all &lt;-<span class="st"> </span><span class="kw">train_Kappa</span>(df_train, <span class="dt">error_est =</span> <span class="st">&quot;oob&quot;</span>, <span class="dt">model =</span> <span class="st">&quot;rf&quot;</span>, <span class="dt">par =</span> T)
res_rf_all$model$finalModel
<span class="kw">confusionMatrix</span>(res_rp_all$model$finalModel)</code></pre></div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="traning-and-evaluating-a-model.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>


<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
},
"search": false
});
});
</script>

</body>

</html>
